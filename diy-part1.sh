#!/bin/bash
#=============================================================================
# iStoreOS RK35XX æ„å»ºå‰ç½®è„šæœ¬ (diy-part1.sh)
# æè¿°: æ„å»ºå‰çš„åˆå§‹åŒ–é…ç½®å’Œè½¯ä»¶æºå‡†å¤‡
# ä½œè€…: P3TERX (Modified by xiaomeng9597)
# åšå®¢: https://p3terx.com
# è®¸å¯è¯: MIT
# æ›´æ–°æ—¶é—´: 2025-09-15
#=============================================================================

set -e  # è„šæœ¬å‡ºé”™æ—¶ç«‹å³é€€å‡º

#-----------------------------------------------------------------------------
# ğŸ“… ç”Ÿæˆç‰ˆæœ¬å· - ä½¿ç”¨ç¼–è¯‘æ—¥æœŸä½œä¸ºæ•°å­—ç‰ˆæœ¬
#-----------------------------------------------------------------------------
echo "ğŸ“… ç”Ÿæˆç‰ˆæœ¬å·..."
date_version=$(date +"%Y%m%d%H")
echo "$date_version" > version
echo "âœ… ç‰ˆæœ¬å·: $date_version"

#-----------------------------------------------------------------------------
# ğŸ·ï¸ è®¾ç½®å›ºä»¶ä½œè€…æ ‡è¯†
#-----------------------------------------------------------------------------
echo "ğŸ·ï¸ é…ç½®å›ºä»¶ä½œè€…æ ‡è¯†..."
author="xiaomeng9597"
# ä¿®æ”¹OpenWrtå‘è¡Œä¿¡æ¯
sed -i "s/DISTRIB_DESCRIPTION.*/DISTRIB_DESCRIPTION='%D %V ${date_version} by ${author}'/g" package/base-files/files/etc/openwrt_release
sed -i "s/OPENWRT_RELEASE.*/OPENWRT_RELEASE=\"%D %V ${date_version} by ${author}\"/g" package/base-files/files/usr/lib/os-release
echo "âœ… ä½œè€…æ ‡è¯†å·²è®¾ç½®: $author"

#-----------------------------------------------------------------------------
# ğŸ“¦ æ·»åŠ è‡ªå®šä¹‰è½¯ä»¶åŒ…ä»“åº“
#-----------------------------------------------------------------------------
echo "ğŸ“¦ æ·»åŠ è‡ªå®šä¹‰è½¯ä»¶åŒ…ä»“åº“..."
echo 'src-git xmpackages https://github.com/xiaomeng9597/openwrt-packages2.git;main' >> feeds.conf.default
echo "âœ… è½¯ä»¶åŒ…ä»“åº“å·²æ·»åŠ : xiaomeng9597/openwrt-packages2"

echo "ğŸ‰ diy-part1.sh æ‰§è¡Œå®Œæˆ"
